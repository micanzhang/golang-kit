FROM micanzhang/golang-testing:1.11

# build protoc
ADD build-protoc.sh build-protoc.sh
RUN /bin/sh build-protoc.sh && rm build-protoc.sh

# golang protobuf plugin
RUN go get -u github.com/golang/protobuf/protoc-gen-go

# install glide
# TODO(micanzhang): remove when go1.12 released
RUN go get -u github.com/Masterminds/glide && rm -rf $GOPATH/src/github.com/Masterminds/glide

# install python3
RUN apt-get install -y python3 python3-pip && \
    pip3 install --upgrade pip setuptools && \
    if [[ ! -e /usr/bin/pip ]]; then ln -s pip3 /usr/bin/pip ; fi && \
    if [[ ! -e /usr/bin/python ]]; then ln -sf /usr/bin/python3 /usr/bin/python; fi && \
    rm -r /root/.cache
